<!doctype html>
<html ng-app="invoiceApp">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Invoice App (AngularJS)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="app.js"></script>
</head>
<body ng-controller="MainCtrl as vm" class="p-4">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark rounded mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#"><i class="fa-solid fa-file-invoice-dollar"></i> Invoice Studio</a>
      <div class="ms-auto text-muted small">Automated Invoice Generator</div>
    </div>
  </nav>

  <div class="container">
    <div class="row g-4">
      <div class="col-lg-5">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{vm.editing ? 'Edit' : 'Create'}} Invoice</h5>
        <form name="invoiceForm" novalidate ng-submit="vm.save()">
          <div class="mb-2">
            <label class="form-label">Client name</label>
            <input class="form-control" ng-model="vm.invoice.clientName" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Client email</label>
            <input class="form-control" ng-model="vm.invoice.clientEmail" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Project</label>
            <input class="form-control" ng-model="vm.invoice.projectName">
          </div>

          <h5>Items</h5>
          <table class="table table-sm">
            <thead>
              <tr><th>Description</th><th>Qty</th><th>Rate</th><th>Amount</th><th></th></tr>
            </thead>
            <tbody>
              <tr ng-repeat="it in vm.invoice.items">
                <td><input class="form-control" ng-model="it.description"></td>
                <td><input type="number" class="form-control" ng-model="it.quantity" ng-change="vm.recalc()"></td>
                <td><input type="number" step="0.01" class="form-control" ng-model="it.rate" ng-change="vm.recalc()"></td>
                <td>{{vm.amount(it) | number:2}}</td>
                <td><button type="button" class="btn btn-sm btn-danger" ng-click="vm.removeItem($index)">x</button></td>
              </tr>
            </tbody>
          </table>
          <div class="mb-2">
            <button type="button" class="btn btn-secondary btn-sm" ng-click="vm.addItem()">Add item</button>
          </div>

          <div class="mb-2">
            <label class="form-label">GST (%)</label>
            <input type="number" class="form-control" ng-model="vm.gstPercent" ng-change="vm.recalc()">
          </div>

          <div class="mb-2">
            <label class="form-label">Status</label>
            <select class="form-select" ng-model="vm.invoice.status">
              <option value="UNPAID">UNPAID</option>
              <option value="PARTIAL">PARTIAL</option>
              <option value="PAID">PAID</option>
            </select>
          </div>

          <div class="mb-3 d-flex justify-content-between align-items-center">
            <div>
              <div class="text-muted small">Subtotal</div>
              <div class="h6 mb-0">{{vm.formatCurrency(vm.invoice.subTotal)}}</div>
            </div>
            <div>
              <div class="text-muted small">GST ({{vm.gstPercent}}%)</div>
              <div class="h6 mb-0">{{vm.formatCurrency(vm.invoice.tax)}}</div>
            </div>
            <div>
              <div class="text-muted small">Total</div>
              <div class="h5 mb-0 text-primary">{{vm.formatCurrency(vm.invoice.total)}}</div>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button class="btn btn-primary w-100" type="submit"><i class="fa-solid fa-floppy-disk me-2"></i>Save Invoice</button>
            <button class="btn btn-outline-secondary" type="button" ng-click="vm.reset()"><i class="fa-solid fa-rotate-left"></i></button>
          </div>
        </div>
      </div>
        </form>
      </div>

      <div class="col-lg-7">
        <div class="d-flex mb-3">
          <input placeholder="Filter by client" class="form-control me-2" ng-model="vm.filterText" ng-change="vm.filter()">
          <button class="btn btn-outline-primary" ng-click="vm.load()"><i class="fa-solid fa-arrows-rotate"></i></button>
        </div>

        <div class="row row-cols-1 g-3">
          <div class="col" ng-repeat="inv in vm.invoices | filter:vm.filterFn">
            <div class="card invoice-card shadow-sm">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-bold">{{inv.clientName}}</div>
                  <div class="text-muted small">{{inv.projectName}} â€¢ {{inv.invoiceDate}}</div>
                </div>
                <div class="text-end">
                  <div class="h5 mb-1">{{vm.formatCurrency(inv.total)}}</div>
                  <div class="small text-muted">{{inv.status}}</div>
                  <div class="mt-2">
                    <button class="btn btn-sm btn-light me-1" ng-click="vm.edit(inv)"><i class="fa-solid fa-pen"></i></button>
                    <button class="btn btn-sm btn-outline-info me-1" ng-click="vm.download(inv.id)"><i class="fa-solid fa-file-pdf"></i></button>
                    <button class="btn btn-sm btn-success me-1" ng-click="vm.send(inv.id)"><i class="fa-solid fa-paper-plane"></i></button>
                    <button class="btn btn-sm btn-outline-danger" ng-click="vm.delete(inv.id)"><i class="fa-solid fa-trash"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
